name: Policy Check

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

permissions:
  contents: read
  pull-requests: read

concurrency:
  group: policy-${{ github.ref }}
  cancel-in-progress: true

jobs:
  enforce-pr-body:
    name: enforce-pr-body
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate PR body sections
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            if (!pr) {
              core.setFailed("Policy Check: pull_request payload is missing. This workflow must be run on pull_request events.");
              return;
            }
            const body = pr.body || "";

            const required = ["[BA]", "[QA]", "[SRE]", "[DEV]"];
            const missing = required.filter(tag => !body.includes(tag));

            if (missing.length > 0) {
              core.setFailed(`Missing required PR sections: ${missing.join(", ")}`);
            } else {
              console.log("All required PR sections are present.");
            }
